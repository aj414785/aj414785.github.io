defineconflict("ams.atm",function(){var comm={atmUrl:"https://ams.game.qq.com/log?sCloudApiName=atm",crossDomainUrl:location.protocol+"//ams.game.qq.com/ams/postATM.html"};var assignValue=function(defaultData,data){for(var k in data){if(data[k]!==undefined){defaultData[k]=data[k]}else if(defaultData[k]===undefined){defaultData[k]=""}}return defaultData};var getGameId=function getGameId(s_url){var url=s_url||window&&window.location.host||"";var gameId=url.replace(/(\w+?)\.qq\.com/gi,"$1");return gameId==url?"":gameId};var ATM={getUin:function(){var t=milo.cookie.get("IED_LOG_INFO2"),IED_LOG_INFO2=t==null?null:milo.unSerialize(t);if(IED_LOG_INFO2==null){return""}uin=IED_LOG_INFO2.userUin;return!isNaN(uin)?uin:milo.cookie.get("uin")},reportATM:function(data,callback){try{var originalData={fromappid:38,frommoduletype:1,toreturncode:1,result:1,struserid:milo.cookie.get("openid")||this.getUin(),serialtime:parseInt((new Date).getTime()/1e3)};if(typeof data=="object"){originalData=assignValue(originalData,data)}if("string"==typeof originalData.tomoduletype){var tonode=originalData.tomoduletype;originalData.tomoduletype=originalData.tomoduletype.indexOf("amesvr")>-1?55:32;if(!originalData.tonode){if(!/^(http)/.test(tonode)){tonode=location.protocol+"//"+tonode}originalData.tonode=tonode}}if(!originalData.actid||!/^[1-9](\d)*$/.test(originalData.actid)){var sCgi=originalData.cgi||location.href;if(sCgi){try{originalData.cgi=sCgi.match(/^([^\?^\#]+)(\?[^\#]*)*(\#.*)*$/)[1];delete originalData.actid}catch(e){}}}this.postATM(originalData,comm.atmUrl,function(res){if(typeof callback=="function"){callback(res)}},3e3)}catch(e){return}},reportVist:function(callback){try{var url=window.location.href;var index1=url.indexOf("?");if(index1>=0){url=url.substring(0,index1)}var index2=url.indexOf("#");if(index2>=0){url=url.substring(0,index2)}var data={errormsg:"\u8bbf\u95ee\u6210\u529f",fromappid:38,frommoduletype:1,toappid:38,tomoduletype:1,tointer:1,businesstype:getGameId(),struserid:milo.cookie.get("openid")||this.getUin(),serialtime:parseInt((new Date).getTime()/1e3),result:0,toreturncode:0};data.cgi=url;this.postATM(data,comm.atmUrl,function(res){if(typeof callback=="function"){callback(res)}},3e3)}catch(e){return}},postATMByBeacon:function(data,url){try{navigator.sendBeacon(url,JSON.stringify(data))}catch(e){}},postATM:function(data,url,callback,outTime){if(milo.browser.msie){this.postATMForIE(data,url,callback,outTime);return}if(!callback&&navigator.sendBeacon){this.postATMByBeacon(data,url);return}try{var timeout;var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status==200){if(typeof callback=="function"){if(timeout){clearTimeout(timeout)}callback(xmlhttp.responseText)}}};xmlhttp.open("post",url,true);xmlhttp.send(JSON.stringify(data));timeout=setTimeout(function(){if(xmlhttp)xmlhttp.abort()},outTime)}catch(e){}},postATMForIE:function(data,url,callback,outTime){if(/^(https?)\:\/\/ams.game.qq.com\/ams\/postATM\.html/.test(location.href)){return}var pAIFrame=null;if(!g("postATMFrame")){pAIFrame=document.createElement("iframe");pAIFrame.id="postATMFrame";pAIFrame.name="postATMFrame";pAIFrame.scrolling="no";pAIFrame.frameBorder="0";pAIFrame.style.width="0px";pAIFrame.style.overflow="hidden";pAIFrame.style.display="none";pAIFrame.style.position="absolute";document.body.appendChild(pAIFrame)}else{pAIFrame=g("postATMFrame")}var delayTime=parseInt(pAIFrame.getAttribute("data-delay")||0);var delayRequest=0;var requestFunc=function(){var postATMUrl=comm.crossDomainUrl;postATMUrl+="?_t="+parseInt(Math.random()*1e5)+"&url="+encodeURIComponent(url)+"&data="+encodeURIComponent(JSON.stringify(data))+"&timeout="+(outTime||0);pAIFrame.src=postATMUrl};if(delayTime&&delayTime>(new Date).getTime()){delayTime+=2e3;delayRequest=delayTime-(new Date).getTime();setTimeout(function(){requestFunc()},delayRequest)}else{requestFunc();delayTime=(new Date).getTime()+2e3}pAIFrame.setAttribute("data-delay",delayTime)}};return ATM});