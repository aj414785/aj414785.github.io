!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define(t):t()}(0,function(){"use strict";var e,t,o=(function(e,t){e.exports=function(){function e(){for(var e=0,t={};e<arguments.length;e++){var o=arguments[e];for(var n in o)t[n]=o[n]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function o(n){function i(){}function r(t,o,r){if("undefined"!=typeof document){"number"==typeof(r=e({path:"/"},i.defaults,r)).expires&&(r.expires=new Date(1*new Date+864e5*r.expires)),r.expires=r.expires?r.expires.toUTCString():"";try{var a=JSON.stringify(o);/^[\{\[]/.test(a)&&(o=a)}catch(e){}o=n.write?n.write(o,t):encodeURIComponent(String(o)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var c="";for(var p in r)r[p]&&(c+="; "+p,!0!==r[p]&&(c+="="+r[p].split(";")[0]));return document.cookie=t+"="+o+c}}function a(e,o){if("undefined"!=typeof document){for(var i={},r=document.cookie?document.cookie.split("; "):[],a=0;a<r.length;a++){var c=r[a].split("="),p=c.slice(1).join("=");o||'"'!==p.charAt(0)||(p=p.slice(1,-1));try{var s=t(c[0]);if(p=(n.read||n)(p,s)||t(p),o)try{p=JSON.parse(p)}catch(e){}if(i[s]=p,e===s)break}catch(e){}}return e?i[e]:i}}return i.set=r,i.get=function(e){return a(e,!1)},i.getJSON=function(e){return a(e,!0)},i.remove=function(t,o){r(t,"",e(o,{expires:-1}))},i.defaults={},i.withConverter=o,i}(function(){})}()}(e={exports:{}}),e.exports);t={},window.location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(e,o){t[e]=o});var n="https://app.ingame.qq.com/gingame/auth";function i(e){return new Promise(function(t,o){var i,r=new XMLHttpRequest,a=e.data,c=e.params;if(i=e.path.startsWith("http")?e.path:n+e.path,c&&"object"==typeof c){var p=-1===i.indexOf("?")?"?":"&";i+=c=p+function(e){return Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")}(c)}e.withCredentials&&(r.withCredentials=!0),r.open(e.method,i),r.responseType="json",e.headers&&Object.keys(e.headers).forEach(function(t){r.setRequestHeader(t,e.headers[t])}),a&&"object"==typeof a&&(a=JSON.stringify(a)),r.onload=function(){r.status>=200&&r.status<300||304==r.status?t(r.response):o({status:r.status,statusText:r.statusText,response:r.response})},r.onerror=function(){o({status:r.status,statusText:r.statusText,response:r.response})},r.send(a)})}var r=navigator.userAgent,a=function(e,t){this.hasCollect=!1,this.config=e,this.type=e.type,this.game=t};a.prototype.getUserInfo=function(e){return(t={appid:e,login_type:"slug",game:this.game},i({method:"get",path:"/get_user_info",withCredentials:!0,params:t})).then(function(e){return e.data}).catch(function(e){console.log(e),alert("鏌ヨ鐢ㄦ埛淇℃伅澶辫触")});var t},a.prototype.getCookieKey=function(){return"slug_exp_"+this.config.appid},a.prototype.isLogin=function(){if("http:"===window.location.protocol)return console.warn("褰撳墠涓篽ttp鍗忚锛屾棤娉曞墠绔牎楠宑ookie锛宨sLogin鏂规硶榛樿杩斿洖true"),!0;if(!this.config.appid)throw new Error("login need appid");return!!o.get(this.getCookieKey())},a.prototype.logout=function(){o.remove(this.getCookieKey(),{domain:".qq.com"}),o.remove("slug_openid_"+this.config.appid,{domain:".qq.com"}),this.hasCollect=!1,sessionStorage.removeItem("tokenParams"),o.remove("tokenParams",{domain:".qq.com"})},a.prototype.checkLogin=function(e,t){var o=this;void 0===t&&(t=this.game);var n,a=this;return(n={appid:e,game:t,game_convert:t,login_type:"slug"},i({method:"get",path:"/check_login",withCredentials:!0,params:n})).then(function(t){if(0===t.code){if(!/msdk/i.test(r)){var n=t.data,i="?appid="+e+"&openid="+n.openid+"&game_openid="+n.game_openid+"&game_appid="+n.game_appid;sessionStorage.setItem("tokenParams",i),"function"==typeof pgvMain&&!o.hasCollect&&__PTTDmp&&(__PTTDmp.searchObj=__PTTDmp.parseQuery(i),PTTSendClick("datareport","login","gameinfo"),o.hasCollect=!0)}return Object.assign({},{isLogin:!0},t.data)}if(67250001===t.code||2===t.code||40030===t.code)return a.logout(),{isLogin:!1};throw a.logout(),t.msg}).catch(function(e){throw e})};var c={appid:"",scope:"snsapi_userinfo",uri:"https://gw.gzh.qq.com/gingame/auth/wxcomponent_login"},p={appid:"",uri:n+"/qqconnect_login"},s={appid:"",uri:n+"/wx_login"},u={wxm:function(e){function t(t,o){e.call(this,t,o)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.toAuth=function(){var e=Object.assign({},c,this.config),t=["appid="+e.appid,"return_uri="+encodeURIComponent(window.location.href),"component_appid=wx22677efbb8d0f79f","game="+this.game];e.uri=encodeURIComponent(e.uri+"?"+t.join("&")),window.location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+e.appid+"&redirect_uri="+e.uri+"&response_type=code&scope="+e.scope+"&state=&component_appid=wx22677efbb8d0f79f#wechat_redirect"},t}(a),qq:function(e){function t(t,o){e.call(this,t,o)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.toAuth=function(){var e=Object.assign({},p,this.config),t=["appid="+e.appid,"rflag=appt","return_uri="+encodeURIComponent(window.location.href),"game="+this.game];e.uri=encodeURIComponent(e.uri+"?"+t.join("&")),window.location.href="https://graph.qq.com/oauth2.0/authorize?response_type=code&client_id="+e.appid+"&redirect_uri="+e.uri+"&scope=get_user_info"},t}(a),wxpc:function(e){function t(t,o){e.call(this,t,o)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.toAuth=function(){var e=Object.assign({},s,this.config),t=["appid="+e.appid,"return_uri="+encodeURIComponent(window.location.href),"game="+this.game];e.uri=encodeURIComponent(e.uri+"?"+t.join("&")),window.location.href="https://open.weixin.qq.com/connect/qrconnect?appid="+e.appid+"&redirect_uri="+e.uri+"&response_type=code&scope=snsapi_login&state=&#wechat_redirect"},t}(a)},f={},d=[],g="",h="",m={};function l(e){if(!u[e])throw"invalid login platform: "+e;if(!d.includes(e))throw"no configuration锛�"+e}function w(e){return l(e),new(0,u[e])(f[e]||{},g)}function _(e,t){for(var o=[],n=arguments.length-2;n-- >0;)o[n]=arguments[n+2];if(e=e||v.curPlatform||h){var i=f[e].appid;return m&&m.type===e||(m=w(e)),m[t].apply(m,[i].concat(o))}if("checkLogin"===t||"isLogin"===t)return!1;console.warn("Unrecognized "+t+" platform")}var y,v={config:function(e){if(!(g=e.game))throw"Please select a game";var t=e.platform;(d=Object.keys(t)).forEach(function(e){l(e),f[e]=Object.assign({},t[e],{type:e})}),h=d.find(function(e){return!!o.get("slug_exp_"+f[e].appid)})},curPlatform:(y=navigator.userAgent,/MicroMessenger/i.test(y)?"wxm":!/ qq/i.test(y.toLowerCase())||/msdk/i.test(y)||/ QQBrowser/i.test(y)?"":"qq"),login:function(e){(e=e||v.curPlatform)?function(e){e.isLogin()&&"http:"!==window.location.protocol||e.toAuth()}(w(e)):console.warn("Unrecognized platform")},isLogin:function(e){return _(e,"isLogin")},logout:function(e){return _(e,"logout")},getUserInfo:function(e){if(!this.isLogin(e))throw"Please login first";return _(e,"getUserInfo")},checkLogin:function(e){var t,o;return void 0===e&&(e={}),"string"==typeof e?t=e:(t=e.platform,o=e.game),this.isLogin(t)?_(t,"checkLogin",o):new Promise(function(e,t){e({isLogin:!1})})}};window.slugLogin=v});
//# sourceMappingURL=index.umd.js.map